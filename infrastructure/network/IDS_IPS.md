IDS / IPS
================

# IDS(Intrusion Detection System)
* 침입 방지 시스템
* 외부에서의 침입에 대한 정보를 수집하고 분석하여 침입 활동을 탐지해 이에 대응할 수 있도록 보안 담당자에게 통보하는 기능을 수행하는 보안 시스템
* 원본 트래픽을 훼손없이 그대로 복사해주는 장비 TAP으로 트래픽을 검사하는 구조
* 트래픽 흐름에는 전혀 관여하지 않음

# IDS 실행 단계
1. 데이터 수집 : 패킷의 흐름으로부터 생성되는 데이터를 수집
2. 데이터 가공 및 축약 : 수집한 데이터를 악의적인 침입인지 판정이 가능하도록 데이터 가공
3. 침입 분석 및 탐지
4. 보고 및 대응

# IDS 종류   
<img width="439" alt="스크린샷 2021-05-21 오전 1 34 52" src="https://user-images.githubusercontent.com/57285121/119016315-bffa7680-b9d4-11eb-94f2-684ac3c096c1.png">   

# 침입 탐지 방법
## 지식기반 침입 탐지
* 오용 탐지 기법, 규칙기반 침입 탐지
* 이미 발견된 공격 패턴을 미리 DB에 저장해두고 해당 공격 패턴과 유사한 경우 침입으로 판단
* 새로운 공격 패턴이나 침입 방식을 지속적으로 DB에 업데이트(패턴 업데이트)
* 장점   
> * 오탐률이 낮음   
* 단점   
> * 새로운 공격 패턴이나 침입 방식을 지속적으로 업데이트를 해줘야하기 때문에 번거로움   
> * 패턴에 없는 새로운 공격은 탐지 불가능   

## 행위기반 침입 탐지
* 이상 탐지 기법, 통계적 변형탐지, 비정상 행위 침입 탐지
* 모니터링한 내용을 정상적인 행위에 대한 정의들(프로파일)과 비교하여 비정상적인 행위를 식별
* 프로파일 기반 이상여부 확인
* Ex) 로그인 횟수가 비정상적으로 많은 경우
* 장점   
> * 별도의 패턴 업데이트가 필요하지 않음   
* 단점   
> * 오탐률이 높음   
> * 정상적인 행위와 비정상적인 행위를 식별하기 위한 경계를 설정하기가 어려움   

# 대응 방법
## 수동적 대응 방법
* 탐지한 공격이나 침입에 대해 보안 관리자에게 조치를 취할 수 있도록 통보하는 형태 (대부분 IDS가 사용)

## 능동적 대응 방법
* 침입에 대해 가장 빠른 조치를 실행하도록 설정하여 침입에 대한 손실을 최소화
* 잘못된 조치를 실행하도록 설정했을 경우에 서비스를 제공할 수 없는 상태가 될 수 있음

# 데이터 수집 주체에 따른 방식
## 호스트 기반 IDS(Host-based IDS) : HIDS
* 호스트의 OS에 설치
* 호스트를 모니터링하여 생성되는 로그를 감시(설치된 파일, 권한 등)하여 침입 여부 판단
* 호스트가 공격 대상이 된 상황에서 사용
* 수동적 대응 방법
* 암호화 패킷 분석 가능
* 장점   
> * 암호화 공격을 탐지할 수 있음   
> * 로그를 직접 참조하여 보다 정확한 대응이 가능함   
* 단점   
> * OS마다 각각 IDS 설치에 따른 비용이 증가   
> * 호스트에 IDS 설치로 인한 시스템 부하 발생 가능성   

## 네트워크 기반 IDS (Network-based IDS) : NIDS
* 네트워크 단위로 설치
* 네트워크에서 전송되는 패킷의 내용(패킷 헤더), 트래픽 양 등을 확인하여 침입 여부 판단
* 능동적 대응 방법
* 암호화된 패킷 분석 불가
* 장점   
> * 네트워크 단위로 IDS를 설치하면 되기 때문(OS에 독립적이라서)에 비용이 저렴   
* 단점   
> * 암호화된 패킷 분석이 불가능   
> * 로그를 직접 참조하지 않기 때문에 HIDS보다 정확한 탐지가 어려움   

# 탐지 시점
## 사후 분석 시스템
* 모니터링을 통해 수집된 데이터를 정해진 시간에만 분석하여 침입 여부 판단
* 즉각적인 대응이 어려움(고전적)

## 실시간 탐지 시스템
* 실시간 정보수집과 동시에 침입을 탐지하고 이에 대응

# IDS 위치
## NIDS    
<img width="698" alt="스크린샷 2021-05-21 오후 12 59 09" src="https://user-images.githubusercontent.com/57285121/119080044-5742e680-ba34-11eb-9bb7-2f7a04dc1121.png">   

1. 패킷이 라우터로 들어오기 전
> * 네트워크 상의 모든 공격을 탐지할 수 있지만 수집되는 데이터가 너무 많아질 수 있음   
2. 라우터 뒤   
> * 라우터의 패킷 필터링을 거친 후 패킷 분석   
3. 방화벽 뒤   
> * 가장 바람직한 위치   
4. 내부 네트워크   
> * 내부 네트워크안의  내부 공격자들을 감시   
5. DMZ(Demilitarized Zone)   
> * 

* 설치 우선 순위 : 3 -> 5 -> 4 -> 2 -> 1

# DMZ(DeMilitarized Zone)
* 방화벽 뒤의 내부 네트워크의 장치를 가져와서 외부에 배치하여 네트워크를 두 부분으로 나눔
* 내부 네트워크에 존재하지만 외부에서 접근할 수 있는 특수한 네트워크 영역   
<img width="902" alt="스크린샷 2021-05-21 오후 2 34 57" src="https://user-images.githubusercontent.com/57285121/119087204-b9561880-ba41-11eb-9f09-619e2c7d7012.png">   

<img width="910" alt="스크린샷 2021-05-21 오후 2 36 34" src="https://user-images.githubusercontent.com/57285121/119087341-f3271f00-ba41-11eb-9492-613cdd599a09.png">   

<img width="679" alt="스크린샷 2021-05-21 오후 2 50 26" src="https://user-images.githubusercontent.com/57285121/119088591-e277a880-ba43-11eb-8b3a-3d973db80a57.png">   

* 외부에서 접속해야 할 웹 서버, 이메일 서버, FTP 서버 등의 영역을 A, 내부에서만 사용하는 DB 등의 내부 정보의 영역을 B라고 가정 
* A -> B는 보안상 우려가 있기 때문에 접속 차단 / B -> A는 보안상 우려가 없기 때문에 접속 허용

# IPS (Intrusion Prevention System)
* 방화벽 + IDS
* 네트워크에서 침입 혹은 외부의 비정상적인 행위 등이 감지되면 즉각적인 차단 조치를 진행
* 내부 네트워크 내 내부 공격자에 대한 접근 통제 가능
* 모니터링 위주의 IDS와 차단 기능을 결합
* 가격이 비싸다는 단점   
<img width="386" alt="스크린샷 2021-05-21 오후 3 13 52" src="https://user-images.githubusercontent.com/57285121/119090914-346dfd80-ba47-11eb-8927-f63487719a29.png">   

* 탐지 기능을 수행하는 IDS가 패킷을 분석한 뒤 정상적인 패킷이 아니면 방화벽에서 해당 패킷을 차단

