π’» [Network] SSH
=================

# π’΅ SSH(Secure Shell) 
* μ•μ „ν• μ„λ²„ μ›κ²© μ ‘μ†μ„ μ„ν• ν”„λ΅ν† μ½
* ν¬νΈλ²νΈλ” 22λ²μ„ μ‚¬μ©
* config νμΌ μ„μΉ
  * `/etc/ssh/sshd_config`
  * `/etc/ssh/ssh_config`
  * `sshd_config` νμΌμ€ ν„μ¬ μ‹μ¤ν…μ΄ SSH μ„λ²„κ°€ λ  λ•(Inbound) μ°Έμ΅°ν•λ” μ„¤μ • νμΌμ΄λ©° `ssh_config` νμΌμ€ ν„μ¬ μ‹μ¤ν…μ΄ SSH ν΄λΌμ΄μ–ΈνΈκ°€ λ  λ•(Outbound) μ°Έμ΅°ν•λ” μ„¤μ • νμΌ

## π“ SSH λ™μ‘ μ›λ¦¬
* ν΄λΌμ΄μ–ΈνΈ - μ„λ²„ λ¨λΈλ΅ λ™μ‘
* κ°κ° SSH ν΄λΌμ΄μ–ΈνΈ λ° λ°λ¬μ΄ μ„¤μΉλμ–΄ μμ–΄μ•Ό ν•¨ - Port 22
* SSH Connectionμ„ μλ¦½ν•λ” κ³Όμ •(μ„λ²„ μΈμ¦ & ν΄λΌμ΄μ–ΈνΈ μΈμ¦)μ—μ„λ” κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹μ„ μ‚¬μ©ν•λ©° Connection μλ¦½ μ΄ν›„μ—λ” λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹μ„ μ‚¬μ©ν•μ—¬ λ°μ΄ν„° ν†µμ‹ 
* μ„λ²„ μΈμ¦ : ν΄λΌμ΄μ–ΈνΈλ” μ ‘μ†ν•κ³ μ ν•λ” μ„λ²„κ°€ μ •μƒμ μΈ μ„λ²„μΈμ§€ κ²€μ¦
  * **κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹(Two Key)** μ‚¬μ©
* ν΄λΌμ΄μ–ΈνΈ μΈμ¦ : μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ ‘κ·Όν•  μ μλ”μ§€ κ²€μ¦
  * **κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹(Two Key)** μ‚¬μ©
* ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ„±κ³µμ μΌλ΅ κ²€μ¦ μ μ°¨λ¥Ό ν†µκ³Όν•κ² λλ©΄ μƒμ„±λλ” μ„Έμ… ν‚¤λ¥Ό ν†µν•΄ μ „μ†΅ν•λ” λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•μ—¬ μ•μ „ν•κ² μ „μ†΅
  * **λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹(One Key)** μ‚¬μ©
* passphrase μ‚¬μ©μΌλ΅ λ³΄μ• κ°•ν™”
  * Private Keyλ¥Ό μ €μ¥ν•  λ• passphraseλ΅ ν•λ² λ” μ•”νΈν™” ν•μ—¬ μ €μ¥
  * Private Key λ¶„μ‹¤μ„ λ€λΉ„ν•λ” λ°©λ²•

## π“ SSH Connection μλ¦½ κ³Όμ • 
μ„λ²„ μΈμ¦ κ³Όμ •

![SSH Connection](https://user-images.githubusercontent.com/57285121/173183049-cdcd8396-6d4d-4db1-8746-741f895c9230.jpg)

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„(SSH λ°λ¬μ΄ μ‹¤ν–‰μ¤‘μΈ)μ— SSH Connection μ”μ²­. μ΄ λ• κ°κ° μ§€μ›ν•λ” μ•”νΈν™” λ°©μ‹μ„ μ„λ΅ κµν™
2. μ„λ²„λ” Public Keyλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ 
3. ν΄λΌμ΄μ–ΈνΈμ—κ² μ„λ²„λ΅ λ¶€ν„° λ°›μ€ Public Keyλ¥Ό λ°›μ•„ λ΅μ»¬μ— μ €μ¥ν• μ§€ λ¬Όμ–΄λ³΄κ³  μ΄ λ• `Yes`λ¥Ό μ„ νƒν•λ©΄ `~/.ssh/known_hosts` μ— μ„λ²„μ Public Keyκ°€ μ €μ¥ λ¨
4. ν΄λΌμ΄μ–ΈνΈλ” λ‚΄λ¶€μ μΌλ΅ λ‚μ κ°’(Hash)μ„ μƒμ„±, λ‚μ κ°’μ„ μ„λ²„μ Public Keyλ΅ μ•”νΈν™”ν•μ—¬ μ„λ²„μ—κ² μ „μ†΅
5. μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° λ°›μ€ λ‚μ κ°’μ„ μ„λ²„μ Private Keyλ΅ λ³µνΈν™”.
6. μ„λ²„λ” λ‚μ κ°’μ„ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬, λ³µνΈν™”ν• λ‚μ κ°’μ΄ ν΄λΌμ΄μ–ΈνΈμ λ‚μ κ°’κ³Ό μΌμΉν•λ”μ§€ κ²€μ¦. κ²€μ¦ μ„±κ³µμ‹ μ„λ²„ μΈμ¦ μ„±κ³µ.

ν΄λΌμ΄μ–ΈνΈ μΈμ¦ κ³Όμ •

![SSH Connection (1)](https://user-images.githubusercontent.com/57285121/173183138-6cc80f48-4e4a-45e2-8fd9-5d4880365c77.jpg)

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² SSH Connection μ”μ²­(Public Key μ •λ³΄ μ „λ‹¬)
2. μ„λ²„λ” `~/.ssh/authorized_keys` νμΌμ— μ”μ²­ λ°›μ€ ν΄λΌμ΄μ–ΈνΈμ Public Key μ •λ³΄κ°€ μλ”μ§€ ν™•μΈ
3. `~/.ssh/authorized_keys` νμΌμ— ν΄λΌμ΄μ–ΈνΈμ Public Key μ •λ³΄κ°€ λ“±λ΅λμ–΄ μλ‹¤λ©΄ ν•΄λ‹Ή Public Keyλ΅ μ„λ²„ λ‚΄λ¶€μ λ‚μ κ°’μ„ μƒμ„± λ° μ•”νΈν™”ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬
4. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„λ΅λ¶€ν„° λ°›μ€ λ‚μ κ°’μ„ ν΄λΌμ΄μ–ΈνΈμ Private Keyλ΅ λ³µνΈν™”.
5. ν΄λΌμ΄μ–ΈνΈλ” λ‚μ κ°’μ„ μ„λ²„μ— μ „λ‹¬, λ³µνΈν™”ν• λ‚μ κ°’μ΄ μ„λ²„μ λ‚μ κ°’κ³Ό μΌμΉν•λ”μ§€ κ²€μ¦. κ²€μ¦ μ„±κ³µμ‹ ν΄λΌμ΄μ–ΈνΈ μΈμ¦ μ„±κ³µ.

* μ„λ²„ λ° ν΄λΌμ΄μ–ΈνΈκ°€ μ„±κ³µμ μΌλ΅ μΈμ¦μ„ λ§μΉ ν›„μ—λ” SSH Connectionμ΄ μλ¦½λκ³  Session Keyλ¥Ό μƒμ„±ν•μ—¬ λ°μ΄ν„° ν†µμ‹  μ‹ Session Keyλ΅ μ•”νΈν™”ν•μ—¬ ν†µμ‹ ν•κ² λ¨
* SSH Connectionμ΄ μΆ…λ£λ ν›„μ—λ” λ‚΄λ¶€μ μΌλ΅ Session Keyλ¥Ό νκΈ°μ²λ¦¬ν•¨

## π“ sshd_config νμΌ μ£Όμ” μµμ…
* `PermitRootLogin`
  * `root` κ³„μ •μΌλ΅ SSH μ ‘μ†μ„ ν—μ©ν•λ”μ§€ μ—¬λ¶€
  * `root` κ³„μ • μ ‘μ†μ„ λ§‰λ” κ²ƒμ„ κ¶κ³  ( `PermitRootLogin : no` )

## π“ SSH Key μƒμ„± λ…λ Ήμ–΄
* `ssh-keygen`
* μƒμ„± μ‹ λ³„λ„μ κ²½λ΅λ¥Ό μ§€μ •ν•μ§€ μ•μΌλ©΄ `~/.ssh` κ²½λ΅μ— `id_rsa.pub` (Public Key) νμΌκ³Ό `id_rsa` (Private Key) νμΌμ΄ μƒμ„±λ¨
* passphrase μ…λ ¥μ€ ν•„μ μ•„λ‹
* μµμ…
  * `-t(type)` : ν‚¤ μƒμ„±μ‹μ— μ‚¬μ©ν•  μ•κ³ λ¦¬μ¦ νƒ€μ…
    * `# ssh-keygen -t rsa`
  * `-b(bit)` : μƒμ„±ν•  ν‚¤μ ν¬κΈ°
    * `# ssh-keygen -t rsa -b 2048`
  * `-f(file)` : μƒμ„±ν•  ν‚¤ νμΌμ μ΄λ¦„ μ§€μ •
    * `# ssh-keygen -t rsa -b 4096 -f dev-key`

