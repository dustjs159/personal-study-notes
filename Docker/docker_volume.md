💻 [Docker] Volume
==================
## Volume
* Docker에서의 볼륨

컨테이너가 실행되며 발생한 데이터(로그나 외부의 입력값 등)는 어디에 저장할 것인가? 만약 컨테이너 내부에만 저장한다면 컨테이너가 종료되면 데이터도 사라지게 될 것이다. 만약 사용자의 로그인 정보를 컨테이너 내부에만 저장하고 컨테이너를 종료하게 된다면 사용자는 다시 회원가입을 해야할 것이다. 때문에 컨테이너 내부에서 실행되는 앱의 데이터는 영속성을 가져야하는 경우가 있기에 컨테이너의 종료나 중지에 상관없이 보존되어야 한다.

* **컨테이너는 자체 파일 시스템을 갖고 있다.**
    * Dockerfile로 빌드할 때 `COPY` 레이어에서 로컬 or VM의 파일 시스템을 스냅샷으로 만들어 컨테이너에서 사용할 뿐, 컨테이너가 작동하며 발생한 데이터는 로컬의 스냅샷을 통해 만들어지는 컨테이너 내부의 파일시스템에 저장된다.
* 따라서 **컨테이너를 한번이라도 종료하게 된다면 컨테이너 내부에 저장되어 있던 데이터가 모두 삭제된다.**
    * 이미지에 레이어 형태로 저장되는 것이 아닌 컨테이너의 내부 파일 시스템에 저장이 되는 것이기 때문!

<img width="863" alt="스크린샷 2023-02-27 오후 11 46 44" src="https://user-images.githubusercontent.com/57285121/221595036-b66841d7-c6ef-4529-b674-7c4d85b7bc13.png">

* docker의 볼륨은 **컨테이너가 인식하는 호스트의 폴더이자 VM에 장착된 디스크이며 이것은 컨테이너 내부와 매핑된다.**
    * 별도의 설정을 하지 않을 경우 도커가 임의의 경로로 설정한다.

## Docker가 컨테이너 데이터를 저장하는 방법
Volume / Bind Mount 두 가지의 방식으로 관리한다.
* Volume : Docker 엔진이 관리하는 가상의 디스크.
    * 익명의(Ananymous) 볼륨 : 별도 설정 없이 컨테이너를 실행할 경우에 생성되며 컨테이너 내부에서 관리 => 컨테이너 종료 시 데이터가 삭제됨
    * 명명된(Named) 볼륨 : 호스트의 특정 디렉토리를 지정하여 해당 위치에 데이터 저장 => 컨테이너를 종료해도 데이터가 남아있음
        * `docker run` 커맨드에 `-v` 옵션을 주어 특정 이름을 부여할 수 있다.
        * `-v {host fs}:{container fs}`
* Bind Mount

## Dockerfile에 볼륨을 지정하여 이미지 빌드하기
* Dockerfile에 `VOLUME` 커맨드를 추가한다.
    * Array 형식으로 작성.
```vim
...
...
VOLUME [ "{container file system}" ]
...
```
* 어? 안된다?
    * docker는 컨테이너 내부로 파일을 이동시키지 않는다.?


### 볼륨 관련 Command
```bash
# 볼륨 리스트
docker volume ls

# 볼륨 삭제
docker volume rm {VOLUME}
docker volume prune

```