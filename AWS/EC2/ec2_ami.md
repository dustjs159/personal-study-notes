💻 [AWS] EC2 AMI
===================  

![](https://images.velog.io/images/dustjs159/post/c7223c11-14b1-4ee6-8f75-af02079aaa05/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202022-01-09%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.02.18.png)

* AMI(Amazon Machine Image) : 인스턴스를 생성하기 위해 필요한 운영체제와 그 외 필요한 소프트웨어들(웹 서버 Nginx 등)이 설치된 이미지
* AWS에서 제공하는 AMI를 커스터마이징하여 동일한 구성의 여러 인스턴스를 찍어내듯 생성 가능(필요한 소프트웨어를 인스턴스 생성할 때마다 설치하지 않아도 됨)
* EC2 생성 시 선택할 수 있는 AMI 종류 
  * Linux : Amazon Linux2, Red Hat Enterprise Linux, Ubuntu, SUSE Linux 등
  * Windows : MS Windows Server
* 이미 만들어져있는 AMI 외에 개인이 직접 제작하여 Marketplace에서 배포도 가능하며 이 경우에는 AMI가 안전하지 않을 수도 있기 때문에 배포자를 잘 확인하고 사용
* 계정 간 공유 가능
* 인스턴스에 필요한 소프트웨어 설치 및 보안 취약점을 조치한 골든 이미지를 통해 인스턴스 셋업 시간을 줄일 수 있음
  * 골든 이미지 없이 작업하는 것은 상당히 괴롭다...

## AMI 생성하기
1. 인스턴스 생성
2. (선택)데이터 무결성을 위해 인스턴스 중지
3. AMI 생성 - Create Image
4. 인스턴스 생성 과정에서 AMI 선택 시, 3 에서 만들어둔 AMI 선택

## 백업용으로 만들어둔 AMI로 인스턴스 복구할 때
루트 EBS 볼륨을 제외하고 추가 볼륨을 Attach 한 상태에서 (+ 인스턴스 내 `/etc/fstab`에 자동 마운트까지 등록된 상태) AMI를 만들었다고 가정하자.

정기적인 백업 정책을 통해 만들어둔 AMI로 인스턴스를 복구할 일이 생겨서 "Launch Instance From AMI"를 하면서 추가 볼륨은 필요 없었기에 Remove하고 인스턴스를 생성했다.

그리고 인스턴스에 접속해보니 .... 추가 볼륨이 Attach된 채로 인스턴스가 생성이 되었고 이를 제거하기 위해 마운트 해제 후 수동으로 볼륨을 detach했다. (비용을 조금이라도 줄이려고)

왜 그런지 찾아봤는데, AMI가 만들어지는 지점은 특정 시점의 스냅샷이기 때문에 원본 인스턴스의 특정 시점을 그대로 가져오는 것이였다. 따라서 콘솔에서 추가 볼륨을 Remove하는 것은 의미가 없었던 것.. 